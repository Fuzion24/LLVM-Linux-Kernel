From f9cbccae31b6091f12cdac213b1d46a0e92c7b2d Mon Sep 17 00:00:00 2001
From: Behan Webster <behanw@converseincode.com>
Date: Mon, 15 Sep 2014 17:10:34 -0700
Subject: [PATCH] kbuild-clang-options

Signed-off-by: Behan Webster <behanw@converseincode.com>
---
 Makefile | 13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

diff --git a/Makefile b/Makefile
index b968f41..4d44260 100644
--- a/Makefile
+++ b/Makefile
@@ -627,10 +627,6 @@ all: vmlinux
 
 include $(srctree)/arch/$(SRCARCH)/Makefile
 
-ifneq ($(COMPILER),clang)
-KBUILD_CFLAGS	+= -fno-delete-null-pointer-checks
-endif
-
 ifdef CONFIG_CC_OPTIMIZE_FOR_SIZE
 KBUILD_CFLAGS	+= -Os $(call cc-disable-warning,maybe-uninitialized,)
 else
@@ -693,10 +689,13 @@ KBUILD_CFLAGS += $(stackp-flag)
 
 ifeq ($(COMPILER),clang)
 KBUILD_CPPFLAGS += $(call cc-option,-Qunused-arguments,)
-KBUILD_CPPFLAGS += $(call cc-option,-Wno-unknown-warning-option,)
 KBUILD_CFLAGS += $(call cc-disable-warning, unused-variable)
 KBUILD_CFLAGS += $(call cc-disable-warning, format-invalid-specifier)
 KBUILD_CFLAGS += $(call cc-disable-warning, gnu)
+KBUILD_CFLAGS += -Wno-asm-operand-widths
+KBUILD_CFLAGS += -Wno-initializer-overrides
+KBUILD_CFLAGS += -fno-builtin
+
 # Quiet clang warning: comparison of unsigned expression < 0 is always false
 KBUILD_CFLAGS += $(call cc-disable-warning, tautological-compare)
 # CLANG uses a _MergedGlobals as optimization, but this breaks modpost, as the
@@ -706,6 +705,7 @@ KBUILD_CFLAGS += $(call cc-option, -mno-global-merge,)
 
 else
 
+KBUILD_CFLAGS	+= -fno-delete-null-pointer-checks
 # This warning generated too much noise in a regular build.
 # Use make W=1 to enable this warning (see scripts/Makefile.build)
 KBUILD_CFLAGS += $(call cc-disable-warning, unused-but-set-variable)
@@ -1607,3 +1607,6 @@ FORCE:
 # Declare the contents of the .PHONY variable as phony.  We keep that
 # information in a variable so we can use it in if_changed and friends.
 .PHONY: $(PHONY)
+
+list-var:
+	@echo "CC => $(CC) $(KBUILD_CFLAGS)"
-- 
1.9.1

