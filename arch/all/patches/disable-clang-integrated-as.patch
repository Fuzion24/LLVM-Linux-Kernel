From 1074d797ae30ebb151a55492f8f5e0fe93b53716 Mon Sep 17 00:00:00 2001
From: Mark Charlebois <charlebm@gmail.com>
Date: Tue, 20 Nov 2012 21:21:12 +0100
Subject: [PATCH] Kbuild: LLVMLinux: Disable the use of the Integrated
 Assembler when compiling with Clang

Globally disable the use of the Clang Integrated Assembler (IA). Use gas
instead. IA doesn't support the gas assembly extensions used in the kernel
code.

Author: Mark Charlebois <charlebm@gmail.com>
Signed-off-by: Mark Charlebois <charlebm@gmail.com>
Signed-off-by: Behan Webster <behanw@converseincode.com>
---
 Makefile | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 2893d7f..89def73 100644
--- a/Makefile
+++ b/Makefile
@@ -407,11 +407,12 @@ KBUILD_CPPFLAGS := -D__KERNEL__
 KBUILD_CFLAGS   := -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs \
 		   -fno-strict-aliasing -fno-common \
 		   -Werror-implicit-function-declaration \
+		   $(call cc-option,-no-integrated-as,) \
 		   -Wno-format-security
 
 KBUILD_AFLAGS_KERNEL :=
 KBUILD_CFLAGS_KERNEL :=
-KBUILD_AFLAGS   := -D__ASSEMBLY__
+KBUILD_AFLAGS   := -D__ASSEMBLY__ $(call cc-option,-no-integrated-as,)
 KBUILD_AFLAGS_MODULE  := -DMODULE
 KBUILD_CFLAGS_MODULE  := -DMODULE
 KBUILD_LDFLAGS_MODULE := -T $(srctree)/scripts/module-common.lds
-- 
1.9.1

