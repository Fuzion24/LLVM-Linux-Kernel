From 3f7f937b7bcabb5bb2fe544e75e6214ccabb137c Mon Sep 17 00:00:00 2001
From: Behan Webster <behanw@converseincode.com>
Date: Wed, 21 May 2014 12:02:30 -0700
Subject: [PATCH] kbuild, LLVMLinux: Add better clang cross build support

Add cross target to CC if using clang. Also add custom gcc toolchain path for
fallback gcc tools.

Signed-off-by: Behan Webster <behanw@converseincode.com>
---
 Makefile | 9 +++++++++
 1 file changed, 9 insertions(+)

--- linux.orig/Makefile
+++ linux/Makefile
@@ -355,7 +355,16 @@
 AS		= $(CROSS_COMPILE)as
 LD		= $(CROSS_COMPILE)ld
 LDFINAL	= $(LD)
+ifeq ($(COMPILER),clang)
+ifneq ($(CROSS_COMPILE),)
+CC		+= -target $(CROSS_COMPILE:%-=%)
+endif
+ifneq ($(GCC_TOOLCHAIN),)
+CC		+= -gcc-toolchain $(GCC_TOOLCHAIN)
+endif
+else
 CC		= $(CROSS_COMPILE)gcc
+endif
 CPP		= $(CC) -E
 ifdef CONFIG_LTO
 AR		= $(CROSS_COMPILE)gcc-ar
