From d38bdcf93aed89e997a00189f9a6c93483cf0ec1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jan-Simon=20M=C3=B6ller?= <dl9pf@gmx.de>
Date: Mon, 15 Apr 2013 22:40:47 +0200
Subject: [PATCH] Cubieboard quick build fix. FIXME.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Jan-Simon MÃ¶ller <dl9pf@gmx.de>
---
 arch/arm/mach-sun4i/pm/standby/standby.c   |  5 +++--
 arch/arm/mach-sun4i/pm/standby/standby.lds |  2 +-
 arch/arm/mach-sun4i/pm/standby/standby_i.h | 19 +++++++++++++++++++
 drivers/gpu/drm/i2c/ch7006_drv.c           |  2 +-
 drivers/gpu/drm/udl/udl_drv.c              |  3 ++-
 5 files changed, 26 insertions(+), 5 deletions(-)

diff --git a/arch/arm/mach-sun4i/pm/standby/standby.c b/arch/arm/mach-sun4i/pm/standby/standby.c
index cb92166..a56b74b 100644
--- a/arch/arm/mach-sun4i/pm/standby/standby.c
+++ b/arch/arm/mach-sun4i/pm/standby/standby.c
@@ -58,8 +58,9 @@ static __u32 dram_traning_area_back[DRAM_TRANING_SIZE];
 * Note       :
 *********************************************************************************************************
 */
-int __attribute__((section(".startup")))main(struct aw_pm_info *arg)
+int __attribute__((section(".startup")))main1(struct aw_pm_info *arg)
 {
+
     char    *tmpPtr = (char *)&__bss_start;
 
     if(!arg){
@@ -74,7 +75,7 @@ int __attribute__((section(".startup")))main(struct aw_pm_info *arg)
     standby_preload_tlb();
 
     /* clear bss segment */
-    do{*tmpPtr ++ = 0;}while(tmpPtr <= (char *)&__bss_end);
+//    do{*tmpPtr ++ = 0;}while(tmpPtr <= (char *)&__bss_end);
 
     /* copy standby parameter from dram */
     standby_memcpy(&pm_info, arg, sizeof(pm_info));
diff --git a/arch/arm/mach-sun4i/pm/standby/standby.lds b/arch/arm/mach-sun4i/pm/standby/standby.lds
index 1049c27..518b401 100644
--- a/arch/arm/mach-sun4i/pm/standby/standby.lds
+++ b/arch/arm/mach-sun4i/pm/standby/standby.lds
@@ -21,7 +21,7 @@
  */
 
 OUTPUT_ARCH(arm)
-ENTRY(main)
+ENTRY(main1)
 
 SECTIONS
 {
diff --git a/arch/arm/mach-sun4i/pm/standby/standby_i.h b/arch/arm/mach-sun4i/pm/standby/standby_i.h
index b151fc4..9dbf010 100644
--- a/arch/arm/mach-sun4i/pm/standby/standby_i.h
+++ b/arch/arm/mach-sun4i/pm/standby/standby_i.h
@@ -24,6 +24,12 @@
 #ifndef __STANDBY_I_H__
 #define __STANDBY_I_H__
 
+#include <linux/types.h>
+#include <linux/string.h>
+#include <linux/ctype.h>
+#include <linux/export.h>
+
+
 #include <linux/power/aw_pm.h>
 #include <mach/platform.h>
 
@@ -40,6 +46,19 @@
 
 extern struct aw_pm_info  pm_info;
 
+extern void __aeabi_memcpy(void *dest, const void *src, size_t n);
+/*inline void __aeabi_memcpy(void *dest, const void *src, size_t n)
+{
+	(void)memcpy(dest, src, n);
+}
+
+
+inline void __aeabi_memset(void *s, size_t n, int c)
+{
+	(void)memset(s, c, n);
+}*/
+extern void __aeabi_memset(void *s, size_t n, int c);
+
 
 static inline __u32 raw_lib_udiv(__u32 dividend, __u32 divisior)
 {
diff --git a/drivers/gpu/drm/i2c/ch7006_drv.c b/drivers/gpu/drm/i2c/ch7006_drv.c
index d3f2e87..e5ca987 100644
--- a/drivers/gpu/drm/i2c/ch7006_drv.c
+++ b/drivers/gpu/drm/i2c/ch7006_drv.c
@@ -495,7 +495,7 @@ static int ch7006_encoder_init(struct i2c_client *client,
 
 static struct i2c_device_id ch7006_ids[] = {
 	{ "ch7006", 0 },
-	{ }
+	{}
 };
 MODULE_DEVICE_TABLE(i2c, ch7006_ids);
 
diff --git a/drivers/gpu/drm/udl/udl_drv.c b/drivers/gpu/drm/udl/udl_drv.c
index 08eff0d..f2e084f 100644
--- a/drivers/gpu/drm/udl/udl_drv.c
+++ b/drivers/gpu/drm/udl/udl_drv.c
@@ -27,7 +27,8 @@ static struct usb_device_id id_table[] = {
 	 .match_flags = USB_DEVICE_ID_MATCH_VENDOR |
 			USB_DEVICE_ID_MATCH_INT_CLASS |
 			USB_DEVICE_ID_MATCH_INT_SUBCLASS |
-			USB_DEVICE_ID_MATCH_INT_PROTOCOL,},
+			USB_DEVICE_ID_MATCH_INT_PROTOCOL,
+	},
 	{},
 };
 MODULE_DEVICE_TABLE(usb, id_table);
-- 
1.8.1.4

