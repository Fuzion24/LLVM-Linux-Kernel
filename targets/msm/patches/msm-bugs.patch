--- msm.orig/arch/arm/mach-msm/vreg.c
+++ msm/arch/arm/mach-msm/vreg.c
@@ -299,7 +299,7 @@
 }
 #else
 static inline int __init vreg_debug_init(void) { return 0; }
-static inline void __exit vreg_debug_exit(void) { return 0; }
+static inline void __exit vreg_debug_exit(void) { return; }
 #endif
 
 static int __init vreg_init(void)
--- msm.orig/drivers/video/msm/Makefile
+++ msm/drivers/video/msm/Makefile
@@ -173,7 +173,7 @@
 
 obj-$(CONFIG_FB_MSM_TVOUT) += tvout_msm.o
 
-ccflags-y := -I$(src)/mhl
+ccflags-y := -I$(src)/mhl -I$(src)
 obj-$(CONFIG_FB_MSM_HDMI_MHL_8334) += mhl-8334.o
 mhl-8334-objs  += mhl/mhl_8334.o
 mhl-8334-objs  += mhl/mhl_i2c_utils.o
--- msm.orig/drivers/gpu/msm/kgsl_iommu.c
+++ msm/drivers/gpu/msm/kgsl_iommu.c
@@ -999,7 +999,7 @@
  *
  * Return - int - number of commands.
  */
-inline unsigned int kgsl_iommu_sync_lock(struct kgsl_mmu *mmu,
+unsigned int kgsl_iommu_sync_lock(struct kgsl_mmu *mmu,
 						unsigned int *cmds)
 {
 	struct kgsl_device *device = mmu->device;
@@ -1057,7 +1057,7 @@
  *
  * Return - int - number of commands.
  */
-inline unsigned int kgsl_iommu_sync_unlock(struct kgsl_mmu *mmu,
+unsigned int kgsl_iommu_sync_unlock(struct kgsl_mmu *mmu,
 					unsigned int *cmds)
 {
 	struct kgsl_device *device = mmu->device;
--- msm.orig/arch/arm/mach-msm/perf_event_msm_krait_l2.c
+++ msm/arch/arm/mach-msm/perf_event_msm_krait_l2.c
@@ -18,6 +18,10 @@
 
 #include <mach/msm-krait-l2-accessors.h>
 
+#ifndef CONFIG_HW_PERF_EVENTS
+#error "CONFIG_HW_PERF_EVENTS is undefined but is required"
+#endif
+
 /*
  * The L2 PMU is shared between all CPU's, so protect
  * its bitmap access.
