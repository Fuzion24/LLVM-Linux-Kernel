From 7a61674f307f030133270a7d78eb72062c8e2e95 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jan-Simon=20M=C3=B6ller?= <dl9pf@gmx.de>
Date: Wed, 14 Nov 2012 13:04:58 +0100
Subject: [PATCH 42/51] Fixes to fs/ for compilation with clang
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Author:  PaX Team <pageexec at freemail.hu>
ML-Post: http://lists.cs.uiuc.edu/pipermail/llvm-commits/Week-of-Mon-20120507/142707.html
URL:     http://llvm.linuxfoundation.org

Merge:   Jan-Simon Möller <dl9pf at gmx.de>

Description:
---
 fs/cifs/cifsacl.c  |    2 +-
 fs/cifs/cifsglob.h |    1 -
 fs/compat_ioctl.c  |    2 +-
 3 Dateien geändert, 2 Zeilen hinzugefügt(+), 3 Zeilen entfernt(-)

--- rpi.orig/fs/cifs/cifsglob.h
+++ rpi/fs/cifs/cifsglob.h
@@ -114,7 +114,6 @@
 /* crypto security descriptor definition */
 struct sdesc {
 	struct shash_desc shash;
-	char ctx[];
 };
 
 /* crypto hashing related structure/fields, not specific to a sec mech */
--- rpi.orig/fs/compat_ioctl.c
+++ rpi/fs/compat_ioctl.c
@@ -807,7 +807,7 @@
  * simple reversible transform to make our table more evenly
  * distributed after sorting.
  */
-#define XFORM(i) (((i) ^ ((i) << 27) ^ ((i) << 17)) & 0xffffffff)
+#define XFORM(i) (((i) ^ (((i) & 0x1f) << 27) ^ (((i) & 0x7fff) << 17)) & 0xffffffff)
 
 #define COMPATIBLE_IOCTL(cmd) XFORM(cmd),
 /* ioctl should not be warned about even if it's not implemented.
