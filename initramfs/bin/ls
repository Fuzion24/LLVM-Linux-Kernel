#!/bin/dash
##############################################################################
# Copyright (c) 2012 Mark Charlebois
# 
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to 
# deal in the Software without restriction, including without limitation the 
# rights to use, copy, modify, merge, publish, distribute, sublicense, and/or 
# sell copies of the Software, and to permit persons to whom the Software is 
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in 
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
# IN THE SOFTWARE.
##############################################################################
dir=`dirname $0`
pwd=`pwd`
cd $dir
cmd=`pwd`/`basename $0`
cd $pwd

flags=""
list=""
num=0
for k in $*
do
	case $k in
	-R)
		flag_R=1;
		;;
	-1)
		flag_1=1;
		;;
	-F)
		flag_F=1;
		;;
	-*)
		echo "Usage $0 -[RF1] [file...]"
		exit 1
		;;
	*)
		if [ -e "$k" ]; then
			if [ -n "$list" ]; then
				num=2
			else
				num=1
			fi
			list=${list}" $k"
			continue
		else
			echo "ls: cannot access ${k}: No such file or directory"
			exit 1
		fi
		;;
	esac
	flags=${flags}" $k"
done
if [ -z "$list" ]; then
	if [ -n "$flag_R" ]; then
		list="."
	else
		list=`echo *`
	fi
fi
flist=""
for k in $list
do
if [ -d $k ]; then 
	if [ -n "$flag_R" ]; then
		dlist=${dlist}" $k"
	fi
	if [ -n "$flag_F" ]; then
		flist=${flist}"$k/  "
	else 
		flist=${flist}"$k  "
	fi
	dirs=1
else
	if [ -n "$flag_F" -a -L "$k" ]; then
		flist=${flist}"${k}@  "
	elif [ -n "$flag_F" -a -x "$k" ]; then
		flist=${flist}"${k}*  "
	else
		flist=${flist}"$k  "
	fi
fi
done
if [ -z "$flist" -a -z "$dirs" ]; then 
	$cmd $flags *
elif [ "" != "$flist" ]; then
	if [ -z "$flag_1" ]; then
		echo "$flist"
	else
	for k in $flist
	do
		echo $k
	done
	fi
fi
for d in $dlist
do
	pwd=`pwd`
	cd $d
	echo
	echo ${d}:
	$cmd $flags *
	cd $pwd
done

