#!/bin/dash
dir=`dirname $0`
pwd=`pwd`
cd $dir
cmd=`pwd`/`basename $0`
cd $pwd

flags=""
list=""
num=0
for k in $*
do
	case $k in
	-R)
		flag_R=1;
		;;
	-1)
		flag_1=1;
		;;
	-F)
		flag_F=1;
		;;
	-*)
		echo "Usage $0 -[RF1] [file...]"
		exit
		;;
	*)
		if [ -n "$list" ]; then
			num=2
		else
			num=1
		fi
		list=${list}" $k"
		continue
		;;
	esac
	flags=${flags}" $k"
done
if [ -z "$list" ]; then
	if [ -n "$flag_R" ]; then
		list="."
	else
		list=`echo *`
	fi
fi
flist=""
for k in $list
do
if [ -d $k ]; then 
	if [ -n "$flag_R" ]; then
		dlist=${dlist}" $k"
	fi
	if [ -n "$flag_F" ]; then
		flist=${flist}"$k/  "
	else 
		flist=${flist}"$k  "
	fi
	dirs=1
else
	if [ -n "$flag_F" -a -L $k ]; then
		flist=${flist}"${k}@  "
	elif [ -n "$flag_F" -a -x $k ]; then
		flist=${flist}"${k}*  "
	else
		flist=${flist}"$k  "
	fi
fi
done
if [ -z "$flist" -a -z "$dirs" ]; then 
	$cmd $flags *
elif [ "" != "$flist" ]; then
	if [ -z "$flag_1" ]; then
		echo "$flist"
	else
	for k in $flist
	do
		echo $k
	done
	fi
fi
for d in $dlist
do
	pwd=`pwd`
	cd $d
	echo
	echo ${d}:
	$cmd $flags *
	cd $pwd
done

